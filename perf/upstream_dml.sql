drop database if exists perf;
create database perf;
\c perf

DROP TABLE IF EXISTS orders;

CREATE TABLE orders
(O_ORDERKEY BIGINT,
O_CUSTKEY INT,
O_ORDERSTATUS CHAR(1),
O_TOTALPRICE DECIMAL(15,2),
O_ORDERDATE DATE,
O_ORDERPRIORITY CHAR(15), 
O_CLERK  CHAR(15), 
O_SHIPPRIORITY INTEGER,
O_COMMENT VARCHAR(79),
dummy text)
PARTITION BY RANGE (O_ORDERDATE);
CREATE TABLE orders_92_jan PARTITION OF orders FOR VALUES FROM ('1992-01-01') TO ('1992-02-01');
CREATE TABLE orders_92_feb PARTITION OF orders FOR VALUES FROM ('1992-02-01') TO ('1992-03-01');
CREATE TABLE orders_92_mar PARTITION OF orders FOR VALUES FROM ('1992-03-01') TO ('1992-04-01');
CREATE TABLE orders_92_apr PARTITION OF orders FOR VALUES FROM ('1992-04-01') TO ('1992-05-01');
CREATE TABLE orders_92_may PARTITION OF orders FOR VALUES FROM ('1992-05-01') TO ('1992-06-01');
CREATE TABLE orders_92_jun PARTITION OF orders FOR VALUES FROM ('1992-06-01') TO ('1992-07-01');
CREATE TABLE orders_92_jul PARTITION OF orders FOR VALUES FROM ('1992-07-01') TO ('1992-08-01');
CREATE TABLE orders_92_aug PARTITION OF orders FOR VALUES FROM ('1992-08-01') TO ('1992-09-01');
CREATE TABLE orders_92_sep PARTITION OF orders FOR VALUES FROM ('1992-09-01') TO ('1992-10-01');
CREATE TABLE orders_92_oct PARTITION OF orders FOR VALUES FROM ('1992-10-01') TO ('1992-11-01');
CREATE TABLE orders_92_nov PARTITION OF orders FOR VALUES FROM ('1992-11-01') TO ('1992-12-01');
CREATE TABLE orders_92_dec PARTITION OF orders FOR VALUES FROM ('1992-12-01') TO ('1993-01-01');
CREATE TABLE orders_93_jan PARTITION OF orders FOR VALUES FROM ('1993-01-01') TO ('1993-02-01');
CREATE TABLE orders_93_feb PARTITION OF orders FOR VALUES FROM ('1993-02-01') TO ('1993-03-01');
CREATE TABLE orders_93_mar PARTITION OF orders FOR VALUES FROM ('1993-03-01') TO ('1993-04-01');
CREATE TABLE orders_93_apr PARTITION OF orders FOR VALUES FROM ('1993-04-01') TO ('1993-05-01');
CREATE TABLE orders_93_may PARTITION OF orders FOR VALUES FROM ('1993-05-01') TO ('1993-06-01');
CREATE TABLE orders_93_jun PARTITION OF orders FOR VALUES FROM ('1993-06-01') TO ('1993-07-01');
CREATE TABLE orders_93_jul PARTITION OF orders FOR VALUES FROM ('1993-07-01') TO ('1993-08-01');
CREATE TABLE orders_93_aug PARTITION OF orders FOR VALUES FROM ('1993-08-01') TO ('1993-09-01');
CREATE TABLE orders_93_sep PARTITION OF orders FOR VALUES FROM ('1993-09-01') TO ('1993-10-01');
CREATE TABLE orders_93_oct PARTITION OF orders FOR VALUES FROM ('1993-10-01') TO ('1993-11-01');
CREATE TABLE orders_93_nov PARTITION OF orders FOR VALUES FROM ('1993-11-01') TO ('1993-12-01');
CREATE TABLE orders_93_dec PARTITION OF orders FOR VALUES FROM ('1993-12-01') TO ('1994-01-01');
CREATE TABLE orders_94_jan PARTITION OF orders FOR VALUES FROM ('1994-01-01') TO ('1994-02-01');
CREATE TABLE orders_94_feb PARTITION OF orders FOR VALUES FROM ('1994-02-01') TO ('1994-03-01');
CREATE TABLE orders_94_mar PARTITION OF orders FOR VALUES FROM ('1994-03-01') TO ('1994-04-01');
CREATE TABLE orders_94_apr PARTITION OF orders FOR VALUES FROM ('1994-04-01') TO ('1994-05-01');
CREATE TABLE orders_94_may PARTITION OF orders FOR VALUES FROM ('1994-05-01') TO ('1994-06-01');
CREATE TABLE orders_94_jun PARTITION OF orders FOR VALUES FROM ('1994-06-01') TO ('1994-07-01');
CREATE TABLE orders_94_jul PARTITION OF orders FOR VALUES FROM ('1994-07-01') TO ('1994-08-01');
CREATE TABLE orders_94_aug PARTITION OF orders FOR VALUES FROM ('1994-08-01') TO ('1994-09-01');
CREATE TABLE orders_94_sep PARTITION OF orders FOR VALUES FROM ('1994-09-01') TO ('1994-10-01');
CREATE TABLE orders_94_oct PARTITION OF orders FOR VALUES FROM ('1994-10-01') TO ('1994-11-01');
CREATE TABLE orders_94_nov PARTITION OF orders FOR VALUES FROM ('1994-11-01') TO ('1994-12-01');
CREATE TABLE orders_94_dec PARTITION OF orders FOR VALUES FROM ('1994-12-01') TO ('1995-01-01');
CREATE TABLE orders_95_jan PARTITION OF orders FOR VALUES FROM ('1995-01-01') TO ('1995-02-01');
CREATE TABLE orders_95_feb PARTITION OF orders FOR VALUES FROM ('1995-02-01') TO ('1995-03-01');
CREATE TABLE orders_95_mar PARTITION OF orders FOR VALUES FROM ('1995-03-01') TO ('1995-04-01');
CREATE TABLE orders_95_apr PARTITION OF orders FOR VALUES FROM ('1995-04-01') TO ('1995-05-01');
CREATE TABLE orders_95_may PARTITION OF orders FOR VALUES FROM ('1995-05-01') TO ('1995-06-01');
CREATE TABLE orders_95_jun PARTITION OF orders FOR VALUES FROM ('1995-06-01') TO ('1995-07-01');
CREATE TABLE orders_95_jul PARTITION OF orders FOR VALUES FROM ('1995-07-01') TO ('1995-08-01');
CREATE TABLE orders_95_aug PARTITION OF orders FOR VALUES FROM ('1995-08-01') TO ('1995-09-01');
CREATE TABLE orders_95_sep PARTITION OF orders FOR VALUES FROM ('1995-09-01') TO ('1995-10-01');
CREATE TABLE orders_95_oct PARTITION OF orders FOR VALUES FROM ('1995-10-01') TO ('1995-11-01');
CREATE TABLE orders_95_nov PARTITION OF orders FOR VALUES FROM ('1995-11-01') TO ('1995-12-01');
CREATE TABLE orders_95_dec PARTITION OF orders FOR VALUES FROM ('1995-12-01') TO ('1996-01-01');
CREATE TABLE orders_96_jan PARTITION OF orders FOR VALUES FROM ('1996-01-01') TO ('1996-02-01');
CREATE TABLE orders_96_feb PARTITION OF orders FOR VALUES FROM ('1996-02-01') TO ('1996-03-01');
CREATE TABLE orders_96_mar PARTITION OF orders FOR VALUES FROM ('1996-03-01') TO ('1996-04-01');
CREATE TABLE orders_96_apr PARTITION OF orders FOR VALUES FROM ('1996-04-01') TO ('1996-05-01');
CREATE TABLE orders_96_may PARTITION OF orders FOR VALUES FROM ('1996-05-01') TO ('1996-06-01');
CREATE TABLE orders_96_jun PARTITION OF orders FOR VALUES FROM ('1996-06-01') TO ('1996-07-01');
CREATE TABLE orders_96_jul PARTITION OF orders FOR VALUES FROM ('1996-07-01') TO ('1996-08-01');
CREATE TABLE orders_96_aug PARTITION OF orders FOR VALUES FROM ('1996-08-01') TO ('1996-09-01');
CREATE TABLE orders_96_sep PARTITION OF orders FOR VALUES FROM ('1996-09-01') TO ('1996-10-01');
CREATE TABLE orders_96_oct PARTITION OF orders FOR VALUES FROM ('1996-10-01') TO ('1996-11-01');
CREATE TABLE orders_96_nov PARTITION OF orders FOR VALUES FROM ('1996-11-01') TO ('1996-12-01');
CREATE TABLE orders_96_dec PARTITION OF orders FOR VALUES FROM ('1996-12-01') TO ('1997-01-01');
CREATE TABLE orders_97_jan PARTITION OF orders FOR VALUES FROM ('1997-01-01') TO ('1997-02-01');
CREATE TABLE orders_97_feb PARTITION OF orders FOR VALUES FROM ('1997-02-01') TO ('1997-03-01');
CREATE TABLE orders_97_mar PARTITION OF orders FOR VALUES FROM ('1997-03-01') TO ('1997-04-01');
CREATE TABLE orders_97_apr PARTITION OF orders FOR VALUES FROM ('1997-04-01') TO ('1997-05-01');
CREATE TABLE orders_97_may PARTITION OF orders FOR VALUES FROM ('1997-05-01') TO ('1997-06-01');
CREATE TABLE orders_97_jun PARTITION OF orders FOR VALUES FROM ('1997-06-01') TO ('1997-07-01');
CREATE TABLE orders_97_jul PARTITION OF orders FOR VALUES FROM ('1997-07-01') TO ('1997-08-01');
CREATE TABLE orders_97_aug PARTITION OF orders FOR VALUES FROM ('1997-08-01') TO ('1997-09-01');
CREATE TABLE orders_97_sep PARTITION OF orders FOR VALUES FROM ('1997-09-01') TO ('1997-10-01');
CREATE TABLE orders_97_oct PARTITION OF orders FOR VALUES FROM ('1997-10-01') TO ('1997-11-01');
CREATE TABLE orders_97_nov PARTITION OF orders FOR VALUES FROM ('1997-11-01') TO ('1997-12-01');
CREATE TABLE orders_97_dec PARTITION OF orders FOR VALUES FROM ('1997-12-01') TO ('1998-01-01');
CREATE TABLE orders_98_jan PARTITION OF orders FOR VALUES FROM ('1998-01-01') TO ('1998-02-01');
CREATE TABLE orders_98_feb PARTITION OF orders FOR VALUES FROM ('1998-02-01') TO ('1998-03-01');
CREATE TABLE orders_98_mar PARTITION OF orders FOR VALUES FROM ('1998-03-01') TO ('1998-04-01');
CREATE TABLE orders_98_apr PARTITION OF orders FOR VALUES FROM ('1998-04-01') TO ('1998-05-01');
CREATE TABLE orders_98_may PARTITION OF orders FOR VALUES FROM ('1998-05-01') TO ('1998-06-01');
CREATE TABLE orders_98_jun PARTITION OF orders FOR VALUES FROM ('1998-06-01') TO ('1998-07-01');
CREATE TABLE orders_98_jul PARTITION OF orders FOR VALUES FROM ('1998-07-01') TO ('1998-08-01');
CREATE TABLE orders_98_aug PARTITION OF orders FOR VALUES FROM ('1998-08-01') TO ('1998-09-01');
CREATE TABLE orders_98_sep PARTITION OF orders FOR VALUES FROM ('1998-09-01') TO ('1998-10-01');
CREATE TABLE orders_98_oct PARTITION OF orders FOR VALUES FROM ('1998-10-01') TO ('1998-11-01');
CREATE TABLE orders_98_nov PARTITION OF orders FOR VALUES FROM ('1998-11-01') TO ('1998-12-01');
CREATE TABLE orders_98_dec PARTITION OF orders FOR VALUES FROM ('1998-12-01') TO ('1999-01-01');
CREATE TABLE orders_default PARTITION OF orders DEFAULT;

create or replace function orders_insert(n int)
returns int
as $$
begin
  for i in 1..n
  loop
    INSERT INTO orders values (4, 1, 'a', 1.00, '1993-01-01', 'foo', 'bar', 1, 'none');
  end loop;
  return n;
end;
$$ language plpgsql;

-- INSERT
select 'INSERT (single-row)';
\timing on
select orders_insert(10000);
\timing off
truncate orders;

select 'INSERT (multi-row)';
\timing on
insert into orders select n, 1, 'a', 1.00, ('1990-01-01'::date + (n%3650)), 'foo', 'bar', 1, 'none' from generate_series(1,100000000) n;
\timing off
truncate orders;

-- COPY
select 'COPY';
\timing on
copy orders from '/tmp/tpchdata/orders.tbl' (DELIMITER '|');
\timing off

-- UPDATE
insert into orders select * from orders;
insert into orders select * from orders;
insert into orders select * from orders;
insert into orders select * from orders;

select 'UDPATE (partition key)';
\timing on
--UPDATE orders SET O_ORDERDATE = O_ORDERDATE + INTERVAL '1day';
UPDATE orders SET O_ORDERDATE = O_ORDERDATE;
\timing off
vacuum orders;

select 'UDPATE (normal column)';
\timing on
UPDATE orders SET O_ORDERSTATUS = 'b';
\timing off
truncate orders;

insert into orders select n, 1, 'a', 1.00, ('1990-01-01'::date + (n%3650)), 'foo', 'bar', 1, 'none' from generate_series(1,100000000) n;
-- DELETE
select 'DELETE';
\timing on
DELETE FROM orders;
\timing off

\c postgres
drop database perf;
